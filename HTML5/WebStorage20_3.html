<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebStorage20_3.html</title>
    <style>
        #menu {
            color: firebrick;
            font-size: 1.2em;
            font-weight: bold;
        }
    </style>
    <script>
        var keyText, valueText, txtArea, span;
        window.onload = function() { //body태그안에 있는 모든 태그들이  load되었을때
            keyText = document.getElementById('key');
            valueText = document.getElementById('val');
            txtArea = document.getElementById('result');
            span = document.getElementById('infoMessage');
        };
        //저장
        function save() {
            console.log('키:%s, 값:%s',keyText.value, valueText.value);
            localStorage.setItem(keyText.value, valueText.value);
            span.innerHTML = '["' + keyText.value + '"키로 ""' + valueText.value +'" 값 저장]';
            //입력값 클리어
            keyText.value = '';
            valueText.value = '';
            //요소에 포커스
            keyText.focus();
        };
        function removeOne() {
            if(keyText.value.length == 0) {
                alert('키값을 입력하세요');
                keyText.focus();
                return;
            }
            var item = localStorage.getItem(keyText.value);
            if(item == null) {
                alert('키값이 존재하지 않습니다.');
                keyText.value = '';
                keyText.focus();
                return;
            }

            localStorage.removeItem(keyText.value);
            alert('삭제되었습니다.');
            selectList();
        };
        function removeAll() {
            if(localStorage.length == 0) {
                alert('삭제할 데이터가 없습니다.'); 
                return;
            }
            localStorage.clear();
            alert('모두 삭제되었습니다.');
            selectList();
        };
        function selectOne() {
            if(keyText.value == '') {
                alert('키값을 입력하세요');
                keyText.focus();
                return;
            }
            alert(keyText.value + '로 조회한 결과: ' + localStorage.getItem(keyText.value));
            
        };
        //모두 조회
        var selectList = function() {
            txtArea.value = '';
            for(var i=0; i<localStorage.length; i++) {
                var key = localStorage.key(i);
                var val = localStorage.getItem(key);
                txtArea.value += key + ' : ' + val + '\r\n'; 
            }
        };
    </script>
</head>
<body> <!--하나의 웹문서를 이르는 객체 : DOM객체(Document Object Model)-->
    <fieldset>
        <legend>웹스토리지-저장/조회/삭제<span id="infoMessage" style="color:green;font-size:0.9em"></span></legend>           
        <table style="background-color:red;border-spacing: 1px;width:90%">
            <tr style="background-color:white">          
                <td style="width:10%">키</td>          
                <td><input style="width:50%" type="text" id="key" /></td>          
            </tr>           
            <tr style="background-color:white">
                <td>값</td>
                <td><input style="width:50%" type="text" id="val" /></td>
            </tr>
            <tr style="background-color:white">
                <td colspan="2">
                    <input type="button" onclick="save()" value="저장" />
                    <input type="button" onclick="removeOne()" value="하나 삭제" />
                    <input type="button" onclick="removeAll()" value="모두 삭제" />
                    <input type="button" onclick="selectOne()" value="키로 조회" />
                    <input type="button" onclick="selectList()" value="모두 조회" />
                </td>
            </tr>
            <tr style="background-color:white">
                <td colspan="2">
                    <textarea id="result" style="width:95%;height:200px"></textarea>
                </td>
            </tr>
        </table>
    </fieldset>
    <fieldset>
        <legend>개인화 설정</legend>
        <input type="checkbox" name="menu" value="날씨"/> 날씨
        <input type="checkbox" name="menu" value="밴드"/> 밴드
        <input type="checkbox" name="menu" value="영화"/> 영화
        <input type="checkbox" name="menu" value="웹툰"/> 웹툰
        <input type="checkbox" name="menu" value="부동산"/> 부동산
        <button onclick="setMenu()">저장</button><br/>
        <span id="menu"></span>
    </fieldset>
    <script>
        var _span = document.getElementById('menu');
        _span.innerHTML = '';
        //로컬 스토리지 저장용 및 출력
        if(localStorage.length != 0) {
            for(var i=0; i<localStorage.length; i++) {
                var key = localStorage.key(i);
                if(key.substr(0,4) == 'MENU') {
                    var menuName = localStorage.getItem(key);
                    _span.innerHTML += menuName + ' ';
                }
            }
        }
        var setMenu = function(){
            _span.innerHTML = '';
            //로컬 스토리지 초기화
            var l = localStorage.length;
             // for(var i=localStrorage.length; i>=0; i--) {
            for(var i=0; i<l; i++) {
                var key = localStorage.key(i);
                if(key!=null && key.substr(0,4) == 'MENU') {
                    localStorage.removeItem(key);
                }
            }
            /* FOR IN문 사용하기
            for(var key in localStorage) {
                if(key.substr(0,4) == 'MENU') {
                    console.log(key);
                    localStorage.removeItem(key);
                }
            }*/

            // FOR EACH문 - 배열에만
            // [example]
            var arr=[1,2,3,4,5];
            arr.forEach((element,index,obj)=>{
                console.log('%s : %s', element, index);
                console.log(obj);
            });
            // FOR IN문 - 배열,객체에 사용
            // for(var in obj) {} -> var에는 키값저장, 배열인 경우 인덱스 저장 / obj 는 배열 혹은 객체

            
            //메뉴 표시용
            var checkboxes = document.getElementsByName('menu');
            for(var i=0; i<checkboxes.length; i++) {
                if(checkboxes[i].checked){//체크했다면
                    _span.innerHTML += checkboxes[i].value + ' ';
                    localStorage.setItem('MENU' + (i+1), checkboxes[i].value);
                }
            }
        };
    </script>
</body>
</html>